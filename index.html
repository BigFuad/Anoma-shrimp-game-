<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Anoma Shrimp</title>
<style>
  body {
    background: #111;
    color: white;
    font-family: 'Arial Black', sans-serif;
    margin: 0;
    padding: 0;
    overflow: hidden;
    user-select: none;
  }
  .landing, .game, .popup {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    height: 100vh;
    background: #111;
  }
  .hidden {
    display: none;
  }
  .red-text {
    color: red;
    font-weight: bold;
    font-size: 3em;
    user-select: none;
  }
  button.red-btn {
    background: red;
    color: white;
    border: none;
    padding: 1em 2em;
    font-size: 1.5em;
    cursor: pointer;
    margin-top: 20px;
    border-radius: 10px;
    user-select: none;
  }
  #maze-container {
    margin-top: 10px;
    position: relative;
  }
  #timer {
    font-size: 1.5em;
    margin: 10px;
    user-select: none;
  }
  #controls {
    position: fixed;
    bottom: 20px;
    display: flex;
    justify-content: center;
    gap: 20px;
  }
  #controls button {
    width: 60px;
    height: 60px;
    background: red;
    color: white;
    font-size: 2em;
    font-weight: bold;
    border-radius: 12px;
    border: none;
    cursor: pointer;
    user-select: none;
  }
  #mute-btn {
    position: fixed;
    top: 10px;
    right: 10px;
    background: #333;
    color: white;
    border: none;
    padding: 10px 15px;
    border-radius: 8px;
    cursor: pointer;
    user-select: none;
    font-weight: bold;
  }
  .popup {
    background: rgba(0,0,0,0.95);
    color: white;
    font-size: 2em;
    flex-direction: column;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    z-index: 100;
    text-align: center;
    padding: 20px;
  }
  .popup button {
    margin-top: 30px;
    background: red;
    border-radius: 10px;
    padding: 0.7em 1.5em;
    font-size: 1.5em;
    border: none;
    cursor: pointer;
    user-select: none;
    font-weight: bold;
  }
  img {
    user-select: none;
  }
</style>
</head>
<body>

<!-- Landing Page -->
<div class="landing" id="landing">
  <img src="mage.png" alt="Shadow Mage Mascot" style="width:180px; margin-bottom: 20px;" />
  <h1>Welcome to the <span class="red-text">Anoma</span> Shrimp Game</h1>
  <button class="red-btn" id="play-btn">Play</button>
</div>

<!-- Game Page -->
<div class="game hidden" id="game">
  <div id="timer">Time: 0.00 s</div>
  <div id="maze-container">
    <canvas id="maze-canvas" width="900" height="400" style="background:#111; display:block; margin:0 auto; border: 4px solid red; border-radius: 10px;"></canvas>
  </div>

  <div id="controls">
    <button id="up" aria-label="Move Up">‚Üë</button>
  </div>
  <div id="controls" style="margin-top:10px;">
    <button id="left" aria-label="Move Left">‚Üê</button>
    <button id="down" aria-label="Move Down">‚Üì</button>
    <button id="right" aria-label="Move Right">‚Üí</button>
  </div>

  <button id="mute-btn" aria-pressed="false">Mute</button>
</div>

<!-- Win Popup -->
<div class="popup hidden" id="win-popup" role="dialog" aria-modal="true" aria-labelledby="win-message">
  <div id="win-message">üéâ Congratulations! You escaped the maze! üéâ</div>
  <img src="cheering-mage.png" alt="Cheering Mage Mascot" style="width: 180px; margin-top: 20px;"/>
  <button id="restart-btn">Play Again</button>
</div>

<script>
  // Canvas and maze setup based on your provided maze image characteristics
  const canvas = document.getElementById('maze-canvas');
  const ctx = canvas.getContext('2d');

  // Maze config (18 cols x 8 rows approx), each cell 50px square
  const cols = 18;
  const rows = 8;
  const cellSize = 50;

  // Maze walls grid: 0 = path, 1 = wall (simplified maze layout inspired by your image)
  // This array should be carefully designed according to your maze design.
  // For demonstration, a simplified maze-like structure is provided.

  // This maze is a simplified grid, 8x18, derived and inspired by your maze shape.
  // Feel free to adjust for full accuracy.
  const maze = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [0,0,0,0,1,0,0,0,0,1,0,0,1,0,0,0,0,1],
    [1,1,0,1,1,0,1,1,0,1,0,1,1,0,1,1,0,1],
    [1,0,0,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0],
    [1,0,1,1,1,0,1,1,1,1,0,1,0,1,0,1,1,1],
    [1,0,0,0,1,0,0,0,0,1,0,0,0,1,0,0,0,1],
    [1,1,1,0,1,1,1,1,0,1,1,1,0,1,0,1,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
  ];

  // Player (shrimp) position in maze cell coordinates
  let playerPos = { x: 1, y: 1 }; // Start cell near the "Start here" area in your image
  // Maze exit position (bottom right)
  const exitPos = { x: 16, y: 6 };

  // Images loading (You need to provide these in your project folder)
  const shrimpImg = new Image();
  shrimpImg.src = 'shrimp.png';  // Shrimp character image

  const mageImg = new Image();
  mageImg.src = 'mage.png';  // Mage mascot image (for win popup or landing)

  const cheeringMageImg = new Image();
  cheeringMageImg.src = 'cheering-mage.png';  // Cheering mage for win popup

  // Background music setup
  const bgMusic = new Audio('game-music.mp3');
  bgMusic.loop = true;
  bgMusic.volume = 0.3;

  // UI Elements
  const landing = document.getElementById('landing');
  const playBtn = document.getElementById('play-btn');
  const game = document.getElementById('game');
  const timerDisplay = document.getElementById('timer');
  const muteBtn = document.getElementById('mute-btn');
  const winPopup = document.getElementById('win-popup');
  const restartBtn = document.getElementById('restart-btn');

  let timer = 0;
  let timerInterval;
  let gameStarted = false;
  let audioPlaying = true;

  function drawMaze() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    // Draw maze
    for(let y=0; y<rows; y++) {
      for(let x=0; x<cols; x++) {
        if(maze[y][x] === 1){
          ctx.fillStyle = 'red';
          ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
        } else {
          ctx.fillStyle = '#111';
          ctx.fillRect(x * cellSize, y * cellSize, cellSize, cellSize);
          // draw path highlights or texture if wished
        }
      }
    }

    // Draw exit text near exit position
    ctx.fillStyle = 'white';
    ctx.font = '14px Arial Black';
    ctx.fillText('LEG!', exitPos.x * cellSize + 10, exitPos.y * cellSize + cellSize / 1.7);

    // Draw shrimp (player)
    ctx.drawImage(shrimpImg, playerPos.x * cellSize + 5, playerPos.y * cellSize + 5, cellSize-10, cellSize-10);
  }

  function isWalkable(x, y){
    return (y >= 0 && y < rows && x >=0 && x < cols && maze[y][x] === 0);
  }

  function movePlayer(dx, dy){
    const newX = playerPos.x + dx;
    const newY = playerPos.y + dy;
    if(isWalkable(newX, newY)){
      playerPos.x = newX;
      playerPos.y = newY;
      drawMaze();
      checkWin();
    }
  }

  function checkWin(){
    if(playerPos.x === exitPos.x && playerPos.y === exitPos.y){
      stopGame();
      showWinPopup();
    }
  }

  function startTimer(){
    timer = 0;
    timerDisplay.textContent = `Time: 0.00 s`;
    timerInterval = setInterval(() => {
      timer += 0.1;
      timerDisplay.textContent = `Time: ${timer.toFixed(2)} s`;
    }, 100);
  }

  function stopTimer(){
    clearInterval(timerInterval);
  }

  function startGame(){
    playerPos = { x: 1, y: 1 };
    drawMaze();
    startTimer();
    gameStarted = true;
    winPopup.classList.add('hidden');
    landing.classList.add('hidden');
    game.classList.remove('hidden');
  }

  function stopGame(){
    gameStarted = false;
    stopTimer();
  }

  function showWinPopup(){
    winPopup.classList.remove('hidden');
    game.classList.add('hidden');
  }

  // Event handlers
  playBtn.onclick = () => {
    bgMusic.play();
    startGame();
  };

  restartBtn.onclick = () => {
    startGame();
  };

  muteBtn.onclick = () => {
    if(audioPlaying){
      bgMusic.pause();
      muteBtn.textContent = 'Unmute';
      muteBtn.setAttribute('aria-pressed', 'true');
    } else {
      bgMusic.play();
      muteBtn.textContent = 'Mute';
      muteBtn.setAttribute('aria-pressed', 'false');
    }
    audioPlaying = !audioPlaying;
  };

  // Keyboard control
  window.addEventListener('keydown', e => {
    if(!gameStarted) return;
    switch(e.key){
      case 'ArrowUp':
        movePlayer(0, -1);
        break;
      case 'ArrowDown':
        movePlayer(0, 1);
        break;
      case 'ArrowLeft':
        movePlayer(-1, 0);
        break;
      case 'ArrowRight':
        movePlayer(1, 0);
        break;
    }
  });

  // Onscreen Button controls
  document.getElementById('up').onclick = () => { if(gameStarted) movePlayer(0, -1); };
  document.getElementById('down').onclick = () => { if(gameStarted) movePlayer(0, 1); };
  document.getElementById('left').onclick = () => { if(gameStarted) movePlayer(-1, 0); };
  document.getElementById('right').onclick = () => { if(gameStarted) movePlayer(1, 0); };

  // Draw initial landing mage if loaded
  mageImg.onload = () => {};
  shrimpImg.onload = () => { drawMaze(); }; // Draw maze initially with shrimp at start
</script>

</body>
</html>
